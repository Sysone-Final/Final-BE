# ì›Œí¬í”Œë¡œìš°ì˜ ì´ë¦„
name: Spring Boot CI/CD to GCP

# ì–¸ì œ ì´ ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹¤í–‰í• ì§€ ì§€ì • (main ë¸Œëœì¹˜ì— push ë  ë•Œ)
on:
  push:
    branches: [ "main" , "ci/SYSONE-38-backend-deploy"]

# ì‹¤í–‰ë  ì‘ì—…ë“¤
jobs:
  deploy:
    # ì´ ì‘ì—…ì„ ì‹¤í–‰í•  ê°€ìƒ í™˜ê²½ (Ubuntu ìµœì‹  ë²„ì „)
    runs-on: ubuntu-latest

    steps:
    # 1. GitHub ë ˆí¬ì§€í† ë¦¬ì˜ ì½”ë“œë¥¼ ê°€ìƒ í™˜ê²½ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
    - name: Checkout source code
      uses: actions/checkout@v3

    # 2. Google Cloud ì¸ì¦í•˜ê¸° (GitHub Secrets ì‚¬ìš©)
    - id: 'auth'
      uses: 'google-github-actions/auth@v1'
      with:
        credentials_json: '${{ secrets.GCP_SA_KEY }}'

    # 3. [í…ŒìŠ¤íŠ¸] ì¸ì¦ì´ ì„±ê³µí–ˆëŠ”ì§€ gcloud ëª…ë ¹ì–´ë¡œ í™•ì¸
    - name: ğŸ§ª [Debug] Check gcloud authentication
      run: |
        echo "--- Checking gcloud auth info ---"
        gcloud auth list
        
        echo "--- Checking project info using authenticated account ---"
        gcloud projects describe ${{ secrets.GCP_PROJECT_ID }}